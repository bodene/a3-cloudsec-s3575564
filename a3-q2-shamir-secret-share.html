<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>3-of-4 Shamir Demo</title>
        <style>
            /* base */
            body {
                font-family: Arial, sans-serif;
                color: #333;
                margin: 20px;
            }
            .container {
                max-width: 800px;
                margin: 0 auto;
            }

            /* headings */
            h1 {
                font-size: 24px;
                margin-bottom: 4px;
            }
            h2 {
                font-size: 16px;
                margin-top: 0;
                color: #666;
                margin-bottom: 20px;
            }

            /* form fields */
            .field {
                margin-bottom: 16px;
            }
            .field label {
                display: block;
                font-weight: bold;
                margin-bottom: 4px;
            }
            .field input[type="text"],
            .field textarea {
                width: 100%;
                box-sizing: border-box;
                font-family: Consolas, monospace;
                font-size: 14px;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }
            .field textarea {
                resize: vertical;
            }

            /* computed outputs */
            .output {
                background-color: #f4f4f4;
                padding: 8px;
                font-family: Consolas, monospace;
                font-size: 14px;
                border-radius: 4px;
                word-break: break-all;
                min-height: 1.4em;
                margin-top: 4px;
            }

            /* buttons */
            button {
                background-color: #007bff;
                color: #fff;
                border: none;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
            }
            button:hover {
                background-color: #0056b3;
            }
        </style>
    </head>
    <body>
        <div class="field">
            <h1>Cloud Security 2025</h1>
            <h2>Shamir Secret Share</h2>

            <div class="field">
                <label for="s">Secret (s):</label>
                <input id="s" name="s" type="text" value="7223563972159051345550582411060769155920130013959131453704507817660458754133699258588096000064440526279584204027239920629989449394216129750888486377101581">
            </div>

            <div class="field">
                <label for="a">a:</label>
                <input id="a" name="a" type="text" value="3575564">
            </div>

            <div class="field">
                <label for="b">b:</label>
                <input id="b" name="b" type="text" value="0">
            </div>

            <div class="field">
                <label for="p">p:</label>
                <textarea id="p" name="p" rows="3">13403289972259406502042916922780955083654211294865670996259360361865384875262941345761952183140190291886907762368198716158616313550662516347148763675584027</textarea>
            </div>

            <div class="field">
                <button type="button" onclick="get_polynomial_equation()">
                    Get Polynomial Equation
                </button>
            </div>

            <div class="field">
                <label>Polynomial equation (mod p):</label>
                <br/>
                f(x) = a * x^2 + b * x + s (mod p) =
                <div id="polynomial_equation" class="output"></div>
            </div>
            <div class="field">
                <button type="button" onclick="compute_4_points()">compute 4 points</button>
            </div>

            <div class="field">
                <label>Points:</label>
                when x = 1, 2, 3, 4
                <div id="point1" class="output"></div>
                <div id="point2" class="output"></div>
                <div id="point3" class="output"></div>
                <div id="point4" class="output"></div>
            </div>

            <div class="field">
                <label>Select any three points above can recover the secret (s): </label>
                <div class="field">
                    <label for="select_x1">select x1: </label><input id="select_x1" name="select_x1" type="text">
                </div>
                <div class="field">
                    <label for="select_y1">select y1: </label><input id="select_y1" name="select_y1" type="text">
                </div>
                <div class="field">
                    <label for="select_x2">select x2: </label><input id="select_x2" name="select_x2" type="text">
                </div>
                <div class="field">
                    <label for="select_y2">select y2: </label><input id="select_y2" name="select_y2" type="text">
                </div>
                <div class="field">
                    <label for="select_x3">select x3: </label><input id="select_x3" name="select_x3" type="text">
                </div>
                <div class="field">
                    <label for="select_y3">select y3: </label><input id="select_y3" name="select_y3" type="text">
                </div>
                <div class="field">
                    <button type="button" onclick="recover_secret()">Recover secret s</button>
                    <div id="recovered_secret" class="output" style="margin-top:8px;"></div>
                </div>
            </div>
        </div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/big-integer/1.6.51/BigInteger.min.js"></script>
        <script type="text/javascript">

            function get_polynomial_equation(){
                let s=document.getElementById("s").value;
                let a=document.getElementById("a").value;
                let b=document.getElementById("b").value;
                let p=document.getElementById("p").value;
                // f(x) = a * x^2 + b * x + s (mod p)
                document.getElementById('polynomial_equation').innerHTML = a + " * x^2 + " + b + " * x + " + s + " (mod " + p + ")";
            }

            function compute_4_points(){
                // get s, a, b, p and convert them to big integer
                let s=document.getElementById("s").value;
                s = bigInt(s);
                let a=document.getElementById("a").value;
                a = bigInt(a);
                let b=document.getElementById("b").value;
                b = bigInt(b);
                let p=document.getElementById("p").value;
                p = bigInt(p);

                // when x = 1, 2, 3, 4
                [1,2,3,4].forEach(i => {
                    const x = bigInt(i);
                    // y = a*x^2 + b*x + s  mod p
                    const ax2 = multiply_mod(a, x.pow(2), p);
                    const bx  = multiply_mod(b, x, p);
                    const y   = add_mod(add_mod(ax2, bx, p), s, p);
                    document.getElementById(`point${i}`)
                        .innerText = `(${i}, ${y.toString()})`;
                });
            }

            // recover secret (f(0)) from any three shares via Lagrange
            function recover_secret(){

                // get mod p
                let p=document.getElementById("p").value;
                p = bigInt(p);

                // get selected three points
                let x1=document.getElementById("select_x1").value;
                x1 = bigInt(x1);
                let y1=document.getElementById("select_y1").value;
                y1 = bigInt(y1);

                let x2=document.getElementById("select_x2").value;
                x2 = bigInt(x2);
                let y2=document.getElementById("select_y2").value;
                y2 = bigInt(y2);

                let x3=document.getElementById("select_x3").value;
                x3 = bigInt(x3);
                let y3=document.getElementById("select_y3").value;
                y3 = bigInt(y3);

                /**
                 * Lagrange basis at 0: l_i = ∏_{j≠i} x_j/(x_j - x_i) mod p
                 * f(0) = y1 * (x2 / (x2 – x1) * x3 / (x3 – x1)) + y2 * (x1 / (x1 – x2) * x3 / (x3 – x2)) + y3 * (x1 / (x1 – x3) * x2 / (x2 – x3))
                 * compute the secret below:
                 **/
                    // first_part = y1 * ( x2/(x2−x1) * x3/(x3−x1) ) mod p
                const e1 = multiply_mod( x2, inverse_mod( sub_mod(x2, x1, p), p ), p );
                const e2 = multiply_mod( x3, inverse_mod( sub_mod(x3, x1, p), p ), p );
                const first_part  = multiply_mod( y1, multiply_mod(e1, e2, p), p );

                // second_part = y2 * ( x1/(x1−x2) * x3/(x3−x2) ) mod p
                const e3 = multiply_mod( x1, inverse_mod( sub_mod(x1, x2, p), p ), p );
                const e4 = multiply_mod( x3, inverse_mod( sub_mod(x3, x2, p), p ), p );
                const second_part  = multiply_mod( y2, multiply_mod(e3, e4, p), p );

                // third_part = y3 * (x1 / (x1 – x3) * x2 / (x2 – x3) mod p
                const e5 = multiply_mod( x1, inverse_mod( sub_mod(x1, x3, p), p ), p );
                const e6 = multiply_mod( x2, inverse_mod( sub_mod(x2, x3, p), p ), p );
                const third_part  = multiply_mod( y3, multiply_mod(e5, e6, p), p );

                let recovered_secret = add_mod(add_mod(first_part, second_part, p), third_part, p);

                document.getElementById('recovered_secret').innerHTML = recovered_secret.toString();
            }

            // necessary computation functions for Big Integer
            // compute a mod b
            function mod(a, b) {
                let result = a.mod(b);
                if (result.isNegative())
                    result = result.add(b);
                return result;
            }
            // compute a^b mod c
            function power_mod(a, b, c){
                let result = a.modPow(b, c);
                return result;
            }
            // compute (a+b) mod c
            function add_mod(a, b, c){
                let result = a.add(b);
                result = mod(result, c);
                return result;
            }
            // compute (a-b) mod c
            function sub_mod(a, b, c){
                let result = a.subtract(b);
                result = mod(result, c);
                return result;
            }
            // compute (a*b) mod c
            function multiply_mod(a, b, c){
                let result = a.multiply(b);
                result = mod(result, c);
                return result;
            }
            // compute a^(-1) mod b
            function inverse_mod(a, b) {
                let result = a.mod(b);
                result = result.modInv(b);
                return result;
            }
        </script>

    </body>
</html>
